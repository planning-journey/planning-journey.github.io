## 2026년 1월 6일

### IndexedDB로 프로젝트 관리 마이그레이션 및 프로젝트 삭제 시 확인 모달과 종속 데이터 삭제 구현

#### 목표
- 프로젝트 데이터를 LocalStorage에서 IndexedDB로 전환하여 관리 효율성 및 데이터 일관성 향상.
- 프로젝트 삭제 시 사용자에게 확인 모달을 제공하여 실수로 인한 데이터 손실 방지.
- 프로젝트 삭제 시 해당 프로젝트에 연결된 모든 할 일, 일일 평가, 목표 데이터를 함께 삭제하여 데이터 무결성 유지.

#### 작업 내역

1. **IndexedDB 라이브러리 설치**:
   - `dexie` 및 `dexie-react-hooks`를 `npm`을 사용하여 설치했습니다.

2. **IndexedDB 스키마 정의**:
   - `src/db.ts` 파일을 생성하여 `PlanningJourneyDB`라는 이름의 IndexedDB 데이터베이스와 `projects`, `goals`, `tasks`, `dailyEvaluations` 스토어를 정의했습니다.
   - 각 스토어의 `id`를 기본 키로 설정하고, `projectId`를 통해 프로젝트와 다른 데이터 간의 관계를 설정했습니다.
   - `Task` 인터페이스에 `date`, `createdAt`, `text` 필드를 추가하고, `DailyEvaluation` 인터페이스에 `evaluationText` 필드를 추가하여 `App.tsx`에서 생성되는 객체 구조와 일치시켰습니다.

3. **LocalStorage에서 IndexedDB로 데이터 마이그레이션**:
   - `App.tsx`에 `useEffect` 훅을 추가하여 애플리케이션 시작 시 LocalStorage에 저장된 프로젝트 데이터가 있으면 IndexedDB로 마이그레이션하고 LocalStorage 데이터를 삭제하도록 구현했습니다.

4. **프로젝트 CRUD 작업 IndexedDB 연동**:
   - `App.tsx`에서 `projects` 상태 관리를 `useLiveQuery` 훅을 사용하여 IndexedDB에서 실시간으로 데이터를 가져오도록 변경했습니다.
   - `handleAddProject`, `handleEditProject`, `handleDeleteProject` 함수들을 `db.projects`와 상호작용하도록 수정했습니다.
     - `handleAddProject`: `db.projects.add()` 사용
     - `handleEditProject`: `db.projects.update()` 사용 (프로젝트 ID를 기반으로 업데이트)
     - `handleDeleteProject`: `db.projects.delete()` 사용 (추후 cascading delete로 대체)

5. **`EditProjectModal` 컴포넌트 수정**:
   - `EditProjectModal.tsx`의 `EditProjectModalProps` 인터페이스를 `oldName` 대신 `projectId`와 `projectName`을 받도록 변경했습니다.
   - `handleSubmit` 함수를 수정하여 `projectId`와 새로운 프로젝트 이름을 `onEditProject` prop으로 전달하도록 변경했습니다.
   - `App.tsx`에서 `EditProjectModal`을 호출하는 부분을 수정하여 변경된 prop에 맞게 데이터를 전달하도록 했습니다.

6. **프로젝트 삭제 확인 모달 및 종속 데이터 삭제 구현**:
   - `App.tsx`에 `projectToDeleteId` 상태를 추가하여 삭제할 프로젝트의 ID를 관리하도록 했습니다.
   - `Sidebar.tsx`에서 프로젝트 삭제 버튼 클릭 시 `onDeleteProjectRequest` prop을 호출하도록 변경했습니다. 이 prop은 `projectToDeleteId`를 설정하고 `ConfirmDeleteModal`을 열도록 `App.tsx`에서 정의됩니다.
   - `App.tsx`의 `closeConfirmDeleteModal` 함수를 수정하여 `goalToDeleteId`와 `projectToDeleteId`를 모두 초기화하도록 했습니다.
   - `App.tsx`의 `handleConfirmDelete` 함수를 확장하여 `projectToDeleteId`가 설정된 경우 다음 작업을 수행하도록 했습니다:
     - `db.projects.delete(projectToDeleteId)`를 통해 프로젝트 자체를 삭제.
     - `db.goals.where({ projectId: projectToDeleteId }).delete()`를 통해 해당 프로젝트의 모든 목표를 삭제.
     - `db.tasks.where({ projectId: projectToDeleteId }).delete()`를 통해 해당 프로젝트의 모든 할 일을 삭제.
     - `db.dailyEvaluations.where({ projectId: projectToDeleteId }).delete()`를 통해 해당 프로젝트의 모든 일일 평가를 삭제.

7. **`.gitignore` 업데이트**:
   - `package-lock.json` 파일이 Git 추적에서 제외되도록 `.gitignore` 파일에 추가했습니다.

#### 변경된 파일
- `src/App.tsx`
- `src/components/EditProjectModal.tsx`
- `src/components/Sidebar.tsx`
- `src/db.ts`
- `.gitignore`

#### 결과
이제 프로젝트 관리는 IndexedDB를 통해 이루어지며, 프로젝트 삭제 시 사용자에게 명확한 확인 절차와 함께 관련된 모든 데이터가 안전하게 삭제됩니다. 이는 데이터 일관성을 보장하고 사용자 경험을 향상시킵니다.
